/**
 * linquan-bus-map - 临泉公交路线图
 * @version v0.1.0
 * @author Sigma
 * @link http://g8up.cn/linquan-map
 */
function loadJScript(e){if(e){var a=document.createElement("script");a.type="text/javascript",a.src=e,document.body.appendChild(a)}}function getMapUrl(e){var a="http://api.map.baidu.com/api?v=2.0&ak=C3ce97caacb39212ea60a36eeb071eb1";return e&&(a=a+"&callback="+e),a}function initMap(){var e=new BMap.Map("map",{minZoom:13});e.centerAndZoom(new BMap.Point(115.269696,33.062182),13),e.enableScrollWheelZoom(!0);var a=new BMap.NavigationControl({anchor:BMAP_ANCHOR_TOP_RIGHT,type:BMAP_NAVIGATION_CONTROL_SMALL});e.addControl(a),Map=e,init()}function init(){renderLine(CurLineNum),$(".list-group").on("click",".list-group-item",function(e){var a=$(e.currentTarget);if(!a.is(".active")){a.addClass("active").siblings(".active").removeClass("active"),hideRoute(CurLineNum);var n=a.data("index");renderLine(n)}})}function main(){var e=getMapUrl("initMap");loadJScript(e)}function drawLine(e,a){var n=new BMap.Polyline([e,a],{strokeColor:"blue",strokeWeight:6,strokeOpacity:.5});Map.addOverlay(n)}function drawPolyline(e){var a=new BMap.Polyline(e,{strokeColor:"blue",strokeWeight:3,strokeOpacity:.6});return Map.addOverlay(a),a}function drawStation(e,a){var n=getBusMarker(e);return setLabel(n,a),n}function setMarker(e){var a=new BMap.Marker(e);return Map.addOverlay(a),a}function getBusMarker(e){var a=new BMap.Marker(e,{icon:getIcon()});return Map.addOverlay(a),a}function getIcon(){if(!diyIconBus){var e=new BMap.Icon("http://webmap1.map.bdstatic.com/wolfman/static/common/images/trans_icons_45ed3d3.png",new BMap.Size(21,21));e.setImageOffset(new BMap.Size(0,-55)),diyIconBus=e}return diyIconBus}function setLabel(e,a){var n=new BMap.Label(a,{offset:new BMap.Size(20,-10)});n.setStyle({borderRadius:"2px"}),e.setLabel(n)}function getLine(e){var a=$.Deferred(),n="http://api.map.baidu.com/geodata/v3/poi/list",t=TableId[e];return t?$.ajax({url:n,data:{ak:"C3ce97caacb39212ea60a36eeb071eb1",geotable_id:t,page_size:100},dataType:"jsonp",success:function(e){if(0===e.status){var n=e.pois;a.resolve(n)}else a.reject(e)},fail:function(){a.reject()}}):a.reject(),a}function drawRoute(e){if(e&&e.length){var a=[],n=[];e.forEach(function(e,t){var i=e.location,r=new BMap.Point(i[0],i[1]),o=e.title;if(a.push(r),1===e.isStation){var c=drawStation(r,o);n.push(c)}});var t=drawPolyline(a);Map.setViewport(a),DataIsland[CurLineNum]={marker:n,polyline:t}}}function hideRoute(e){var a=DataIsland[CurLineNum];if(a){var n=a.marker,t=a.polyline;n&&n.forEach(function(e){e.hide()}),t&&t.hide()}}function showRoute(e){var a=DataIsland[e];if(a){var n=a.marker,t=(a.label,a.polyline);n&&n.forEach(function(e){e.show()}),t&&t.show(),Map.setViewport(t.getPath())}}function renderLine(e){DataIsland[e]?showRoute(e):$.when(getLine(e)).then(function(e){drawRoute(e)},function(e){}),CurLineNum=e}var TableId={1:103489,2:103047,3:103586,4:103619,5:103646,6:103648,7:103581},Map=null;window.onload=main;var diyIconBus=null,DataIsland={},CurLineNum=2;